<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>By Cooked</title>
    <link rel="stylesheet" href="../css/comidas.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
</head>

<body>
    <header>
        <div class="logo">By Cooked</div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="salgados.html">Receitas salgadas</a></li>
                <li><a href="doces.html">Receitas doces</a></li>
                <li><a href="vegetariana.html">Receitas vegetarianas</a></li>
                <p>|</p>
                <li><a href="dashboard.html">üßëüèª‚Äçüç≥ Usu√°rio</a></li>
            </ul>
        </nav>
    </header>
    
    <div class="comidas">
        <h1>Risoto de Filet Mignon</h1>

        <div class="topo-receita">
            <div class="lado-esquerdo">
                <div class="box">
                    <img src="../img/risoto_filet.jpeg" alt="filet">
                </div><br>
                <p class="rendimento">
                    Receita rende 16 por√ß√µes
                </p>
            </div>
            <div class="lado-direito">
                <div class="tempo-preparo">
                    ‚è±Ô∏è 55 min
                </div>
                <p class="descricao-receita">
                    Eleg√¢ncia e sabor se encontram nesse risoto de fil√© mignon, uma fus√£o perfeita entre a cremosidade
                    italiana e a sucul√™ncia da carne brasileira. Ideal pra impressionar em qualquer ocasi√£o!
                </p><br>
                
                <button class="botao-favorito" data-receita-id="3" data-favoritado="false">
                    ‚ù§Ô∏è Favoritar
                </button>

            </div>
        </div>

        <main class="conteudo-receita">
            <section class="ingredientes">
                <h2>Ingredientes</h2>
                <ul>
                    <li>2 x√≠caras de arros arb√≥reo</li>
                    <li>350 g de fil√©-mignon picado em tiras</li>
                    <li>1 x√≠cara (ch√°) de champignon fatiado</li>
                    <li>1 x√≠cara (ch√°) de vinho branco seco</li>
                    <li>1 x√≠cara e meia (ch√°) de √°gua quente</li>
                    <li>1 x√≠cara e meia (ch√°) de caldo de carne caseiro</li>
                    <li>1 pitada de noz-moscada em p√≥</li>
                    <li>2 colheres (sopa) de margarina</li>
                    <li>1 cebola-roxa picada</li>
                    <li>2 dentes de alho picado</li>
                    <li>1 colher (ch√°) de sal</li>
                    <li>1 pitada de pimenta-do-reino preta mo√≠da</li>
                    <li>1 fio de azeite</li>
                    <li>100 mL de √°gua</li>
                    <li>1 colher (ch√°) de cebolinha picada</li>
                </ul>
            </section>

            <section class="preparo">
                <h2>Modo de Preparo</h2>
                <ol>
                    <li>Em uma frigideira, coloque metade da margarina e deixe derreter.</li>
                    <li>Acrescente o fil√© mignon e tempere com o sal e a pimenta-do-reino.</li>
                    <li>Adicione o champignon fatiado e refogue at√© o fil√© mignon come√ßar a fritar.</li>
                    <li>Retire o fil√© mignon e os cogumelos da panela e reserve.</li>
                    <li>Na mesma frigideira, coloque o azeite e o restante da margarina. Adicione a cebola-roxa e o alho
                        e refogue.</li>
                    <li>Acrescente o arroz arb√≥reo e mexa bem. Adicione o sal e o vinho branco seco.</li>
                    <li>Acrescente o caldo de carne aos poucos e deixe cozinhar por cerca de 20 minutos.</li>
                    <li>Adicione o fil√© mignon e o champignon reservados e a noz-moscada.</li>
                    <li>Adicione a cebolinha. Misture bem.</li>
                    <li>Sirva a seguir.</li>
                </ol>
            </section>
        </main>

        <footer>
            <div class="footer-content">
                <p>&copy; 2025 By Cooked. Todos os direitos reservados.</p>
                <nav>
                    <a href="#">Sobre</a>
                    <a href="#">Contato</a>
                </nav>
            </div>
        </footer>
    </div>
</body>
<script>
    document.querySelectorAll(".botao-favorito").forEach(botao => {
    botao.addEventListener("click", () => {
        const idReceita = botao.getAttribute("data-receita-id");
        const favoritado = botao.getAttribute("data-favoritado") === "true";
        const idUsuario = sessionStorage.ID_USUARIO;

        if (!idUsuario) {
            alert("Voc√™ precisa estar logado para favoritar uma receita.");
            window.location.href = "../login.html";
            return;
        }

        const url = favoritado ? "/favoritos/desfavoritar" : "/favoritos/favoritar";
        const metodo = favoritado ? "DELETE" : "POST";

        fetch(url, {
            method: metodo,
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUsuario: idUsuario,
                idReceita: idReceita
            })
        }).then(res => {
            if (res.ok) {
                const novoEstado = !favoritado;
                botao.setAttribute("data-favoritado", novoEstado.toString());
                botao.innerText = novoEstado ? "üíî Desfavoritar" : "‚ù§Ô∏è Favoritar";
            } else {
                alert("Erro ao atualizar favorito.");
            }
        }).catch(err => {
            console.error(err);
            alert("Erro de conex√£o.");
        });
    });
});

window.addEventListener("load", () => {
    const idUsuario = sessionStorage.ID_USUARIO;
    if (!idUsuario) return;

    fetch(`/favoritos/listar/${idUsuario}`)
        .then(res => res.json())
        .then(favoritos => {
            const idsFavoritados = favoritos.map(f => f.fk_receitas.toString());

            document.querySelectorAll(".botao-favorito").forEach(botao => {
                const idReceita = botao.getAttribute("data-receita-id");
                if (idsFavoritados.includes(idReceita)) {
                    botao.setAttribute("data-favoritado", "true");
                    botao.innerText = "üíî Desfavoritar";
                }
            });
        })
        .catch(erro => console.error("Erro ao carregar favoritos:", erro));
});
</script>
</html>